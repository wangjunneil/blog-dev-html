<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"> <!-- pwa meta begin --><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#000"><meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="format-detection" content="telephone=no"><meta name="msapplication-tap-highlight" content="no"> <!-- IOS不会读取manifest中的icon，用此配置进行适配 --><link rel="apple-touch-icon" href="assets/icons/icon-96x96.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/icon-180x180.png"><link rel="apple-touch-icon" sizes="167x167" href="/assets/icons/icon-167x167.png"> <!-- ios修复splash黑屏 --><link href="/assets/img/icons/apple_splash_1125.png" sizes="1125x2436" rel="apple-touch-startup-image" /><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"> <!-- pwa meta end --><title>去中心化的宠物领养 DApp 应用</title><meta name="description" content=""><meta name="keywords" content="truffle,ganache,solidity"><link rel="stylesheet" href="/assets/fonts/fonts.css"><link rel="icon" href="/assets/favicon.ico"><link rel="stylesheet" href="/assets/core.css"><link rel="stylesheet" href="/assets/syntax.css"><link rel="canonical" href="/2022/12/pet-shop-dapp/"><link rel="alternate" type="application/atom+xml" title="The Jun Wong's blog" href="/feed.xml" /></head><body> <!-- 全局页面loading --><div class="loading"><div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div></div><!-- search --><div class="searchform"> <a href="javascript:void(0);" class="searchicon"></a> <input type="text" id="keyword" autocomplete="off"/> <a href="javascript:void(0);" class="clear"></a><ul class="suggest"></ul></div><script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script> <script src="/assets/js/main.js"></script><nav class="header-nav"> <a class="page-link" href="/">HOME</a> / <a class="page-link" href="/categories/">CATEGORY</a> / <a class="page-link" href="/feed.xml">FEED</a> / <a class="page-link" href="/about/">ABOUT</a></nav><main><article> <!-- 目录导航，在nav,js中进行渲染 --><div class="w-catalog"></div><div class="w-catalog-btn">目录</div><div class="center"><h1>去中心化的宠物领养 DApp 应用</h1><time>2022-12-21</time></div><div class="divider"></div><ul id="markdown-toc"><li><a href="#1-知识点" id="markdown-toc-1-知识点">1. 知识点</a></li><li><a href="#2-阅读前提" id="markdown-toc-2-阅读前提">2. 阅读前提</a></li><li><a href="#3-实现步骤" id="markdown-toc-3-实现步骤">3. 实现步骤</a><ul><li><a href="#31-使用-truffle-完成合约编写部署" id="markdown-toc-31-使用-truffle-完成合约编写部署">3.1 使用 Truffle 完成合约编写&amp;部署</a><ul><li><a href="#311-初始化工程" id="markdown-toc-311-初始化工程">3.1.1. 初始化工程</a></li><li><a href="#312-编写合约代码" id="markdown-toc-312-编写合约代码">3.1.2. 编写合约代码</a></li><li><a href="#313-编译合约代码" id="markdown-toc-313-编译合约代码">3.1.3. 编译合约代码</a></li><li><a href="#314-编写部署脚本" id="markdown-toc-314-编写部署脚本">3.1.4. 编写部署脚本</a></li><li><a href="#315-部署合约" id="markdown-toc-315-部署合约">3.1.5. 部署合约</a></li></ul></li><li><a href="#32-前端工程开发" id="markdown-toc-32-前端工程开发">3.2. 前端工程开发</a><ul><li><a href="#321-hello的页面" id="markdown-toc-321-hello的页面">3.2.1. Hello的页面</a></li><li><a href="#322-引入合约处理库" id="markdown-toc-322-引入合约处理库">3.2.2. 引入合约处理库</a></li><li><a href="#323-创建appjs处理合约交互" id="markdown-toc-323-创建appjs处理合约交互">3.2.3. 创建app.js处理合约交互</a></li></ul></li><li><a href="#33-运行测试应用" id="markdown-toc-33-运行测试应用">3.3. 运行测试应用</a></li></ul></li><li><a href="#4-faq" id="markdown-toc-4-faq">4. FAQ</a><ul><li><a href="#41-如何解决truffle-compile下载solc报错" id="markdown-toc-41-如何解决truffle-compile下载solc报错">4.1. 如何解决truffle compile，下载solc报错？</a></li><li><a href="#42-完整代码下载路径" id="markdown-toc-42-完整代码下载路径">4.2. 完整代码下载路径</a></li></ul></li></ul><h2 id="1-知识点">1. 知识点</h2><ol><li>合约框架 <a href="https://trufflesuite.com/docs/truffle/quickstart/">Truffle</a> 的使用，如何编译、发布合约到测试区块链 <a href="https://trufflesuite.com/docs/ganache/quickstart/">Ganache</a> 中</li><li>前端是一个基本的 HTML+JS 的工程，在没有使用前端框架的情况下，如何使用 <a href="https://web3js.readthedocs.io/en/v1.8.1/">web3.js</a></li><li>前端 JS 中如何使用 <a href="https://web3js.readthedocs.io/en/v1.8.1/">web3.js</a> 与合约交互<ul><li>初始化 Provider，连接 MetaMask</li><li>调用合约，处理合约返回的数据</li></ul></li></ol><h2 id="2-阅读前提">2. 阅读前提</h2><ul><li>熟悉使用 <a href="https://docs.soliditylang.org/en/v0.8.17/">Solidity</a> 编写合约，合约的基本语法</li><li>熟悉使用 <a href="https://trufflesuite.com/docs/truffle/quickstart/">Truffle</a> 集成框架处理合约</li><li>熟悉使用 <a href="https://trufflesuite.com/docs/ganache/quickstart/">Ganache</a> 私有测试区块链的基本使用</li><li>基本的 HTML/JS 的使用</li></ul><h2 id="3-实现步骤">3. 实现步骤</h2><p><strong>产品需求</strong>：实现一个宠物领养的页面，可以点击领养，查询所有已经领养的宠物，这里宠物领养后的归属人为以<strong>太坊账户</strong>。</p><p><strong>最终效果</strong>：<a href="#33-运行测试应用">运行结果</a></p><p><strong>实现方案</strong>：</p><p><img src="https://pic.wangjun.dev/i/2022/12/21/chpmlg-0.png" alt="web3-pet-shop.drawio" /></p><h3 id="31-使用-truffle-完成合约编写部署">3.1 使用 Truffle 完成合约编写&amp;部署</h3><h4 id="311-初始化工程">3.1.1. 初始化工程</h4><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>pet-shop <span class="o">&amp;&amp;</span> <span class="nb">cd </span>pet-shop
truffle init
</code></pre></div></div><p>执行后的目录结构如下：</p><p><img src="https://pic.wangjun.dev/i/2022/12/21/atzrix.jpg" alt="truffle init" /></p><h4 id="312-编写合约代码">3.1.2. 编写合约代码</h4><p>在项目的 <code class="language-plaintext highlighter-rouge">contracts</code> 目录中创建一个 <code class="language-plaintext highlighter-rouge">Adoption.sol</code> 文件，使用 <code class="language-plaintext highlighter-rouge">Solidity</code>语言编写如下代码：</p><div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SPDX-License-Identifier: MIT
</span>
<span class="k">pragma</span> <span class="n">solidity</span> <span class="mf">0.8</span><span class="p">.</span><span class="mi">17</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">Adoption</span> <span class="p">{</span>

    <span class="c1">// 定义一个address类型的固定数组，表示收养者
</span>    <span class="kt">address</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="k">public</span> <span class="n">adopters</span><span class="p">;</span>

    <span class="k">function</span> <span class="n">adopt</span><span class="p">(</span><span class="kt">uint</span> <span class="n">petId</span><span class="p">)</span> <span class="k">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">petId</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">petId</span> <span class="o">&lt;=</span><span class="mi">15</span><span class="p">);</span>

        <span class="n">adopters</span><span class="p">[</span><span class="n">petId</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">petId</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">getadopters</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="k">memory</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">adopters</span><span class="p">;</span>
    <span class="p">}</span>
    
<span class="p">}</span>
</code></pre></div></div><p>上面代码定义一个 <code class="language-plaintext highlighter-rouge">address</code> 类型的数组，用于存储领养人（以太坊账户）的信息，总共16个，对应页面宠物的数据也是 16个，另外还定义了两个函数：</p><ul><li>function adopt()：领养宠物，宠物使用数组索引代替，合约的调用者 msg.sender 代表领养人</li><li>function getadopters()：获取所有领养人信息</li></ul><h4 id="313-编译合约代码">3.1.3. 编译合约代码</h4><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>truffle compile
</code></pre></div></div><p>执行完上述命令后，truffle 会编译 <code class="language-plaintext highlighter-rouge">contracts</code>目录中的合约文件，在项目根目录<code class="language-plaintext highlighter-rouge">build/contracts</code>生成编译后的 Adoption.json 文件，这个 Json 文件包含了合约的重要信息，如 <strong>ABI</strong> 和 <strong>bytecode</strong>。</p><blockquote><p><a href="#41-如何解决truffle-compile下载solc报错">执行 <code class="language-plaintext highlighter-rouge">truffle compile</code>，下载 solc 报错，如何解决？</a></p></blockquote><h4 id="314-编写部署脚本">3.1.4. 编写部署脚本</h4><p>在项目<code class="language-plaintext highlighter-rouge">migrations</code>目录中新建<code class="language-plaintext highlighter-rouge">1_deploy_contract.js</code></p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">Adoption</span> <span class="o">=</span> <span class="nx">artifacts</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">Adoption</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">deployer</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">deployer</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">Adoption</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div><p>这里的脚本名称有规则，必须”<strong>数字_</strong>“开头，否则truffle不能识别到部署脚本</p><h4 id="315-部署合约">3.1.5. 部署合约</h4><p>部署合约分两步：</p><ol><li>启动本地 Ganache 区块链</li><li>在 Truffle 的配置文件 truffle-config.js 中指定区块链连接信息</li></ol><p>启动 Ganache 区块链，获取连接信息</p><p><img src="https://pic.wangjun.dev/i/2022/12/21/c0bcgv-0.jpg" alt="20221220232629" /></p><p>配置 truffle-config.js 文件，配置连接，执行<code class="language-plaintext highlighter-rouge">truffle migrate</code>部署合约到链中</p><p><img src="https://pic.wangjun.dev/i/2022/12/21/c2rwbj-0.jpg" alt="20221220232945" /></p><p>上面可以看到当我们执行完<code class="language-plaintext highlighter-rouge">truffle migrate</code>后，合约已经部署成功，对应区块链上的地址也已经生成，至此合约部分已经完成，<u>这里可以理解为后端的处理服务已经完成</u>，下面开始编写前端与合约交互部分。</p><p><img src="https://pic.wangjun.dev/i/2022/12/21/c53u5w-0.jpg" alt="20221220233432" /></p><h3 id="32-前端工程开发">3.2. 前端工程开发</h3><h4 id="321-hello的页面">3.2.1. Hello的页面</h4><p>本节目的，创建 index.html 页面，启动一个 web 服务，运行浏览器显示页面的 Hello 信息，就是一个基本的静态站点</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 初始化一个node工程，安装 lite-server 服务器</span>
npm init <span class="nt">--yes</span>
npm <span class="nb">install </span>lite-server <span class="nt">--save-dev</span>

<span class="c"># 创建一个测试的html文件</span>
<span class="nb">mkdir </span>src <span class="o">&amp;&amp;</span> <span class="nb">cd </span>src
<span class="nb">echo</span> <span class="s2">"Hello"</span> <span class="o">&gt;&gt;</span> index.html
</code></pre></div></div><p>跟路径创建 <code class="language-plaintext highlighter-rouge">lite-server</code>配置文件 <code class="language-plaintext highlighter-rouge">bs-config.json</code>，指定服务器启动后加载的资源路径</p><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w"> 
  </span><span class="nl">"server"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"baseDir"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"./src"</span><span class="p">,</span><span class="w"> </span><span class="s2">"./build/contracts"</span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><blockquote><p>这里值得注意的是<code class="language-plaintext highlighter-rouge">bs-config.json</code>文件除了指定了html资源的所在位置，还指定了编译后合约 json 文件的所在位置，后续在 js 中可以不指定路径，直接引用合约的 abi 文件</p></blockquote><p>编辑 <code class="language-plaintext highlighter-rouge">package.json</code>文件，增加启动<code class="language-plaintext highlighter-rouge">lite-server</code>的运行命令</p><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span><span class="w"> </span><span class="err">Inside</span><span class="w"> </span><span class="err">package.json...</span><span class="w">
</span><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">    
  </span><span class="nl">"dev"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lite-server"</span><span class="w">
</span><span class="p">}</span><span class="err">,</span><span class="w">
</span></code></pre></div></div><p>运行命令<code class="language-plaintext highlighter-rouge">npm run dev</code>，打开浏览器检查我们搭建的静态服务是否已经可用</p><p><img src="https://pic.wangjun.dev/i/2022/12/21/cgd8xl-0.jpg" alt="20221220235351" /></p><p>至此我们的静态服务器搭建完成，下面开始创建与合约交互的脚本逻辑</p><h4 id="322-引入合约处理库">3.2.2. 引入合约处理库</h4><p>编辑<code class="language-plaintext highlighter-rouge">index.html</code>引入下面<a href="https://cdnjs.cloudflare.com/ajax/libs/web3/1.8.1/web3.min.js">web3.js</a>、<a href="https://cdn.jsdelivr.net/npm/@truffle/contract@4.2.31/dist/truffle-contract.min.js">truffle-contract.js</a>已经后面的<code class="language-plaintext highlighter-rouge">app.js</code>文件</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
  	......
	<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/web3.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/truffle-contract.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/app.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div><blockquote><p>这里省略了其余内容以及对应的资源文件，完整的项目文件可在FAQ的<a href="#42-完整代码下载路径">完整代码下载路径</a>中获取</p></blockquote><h4 id="323-创建appjs处理合约交互">3.2.3. 创建app.js处理合约交互</h4><p>合约交互分为以下几个流程：</p><ul><li><strong>初始化 web3 对象，获取 provider</strong></li><li><strong>为 contract 设置 provider</strong></li><li><strong>调用 contract.getadopters() 函数获取历史领养数据</strong></li><li><strong>注册 adopt 按钮事件，调用 contract.adopt() 领养函数</strong></li></ul><ol><li>初始化 web3 对象，获取 provider</li></ol><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 1. 初始化 Web3</span>
<span class="nx">initWeb3</span><span class="p">:</span> <span class="k">async</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">ethereum</span><span class="p">)</span> <span class="p">{</span>	<span class="c1">// Metamask</span>
    <span class="nx">App</span><span class="p">.</span><span class="nx">web3Provider</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">ethereum</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">await</span> <span class="nb">window</span><span class="p">.</span><span class="nx">ethereum</span><span class="p">.</span><span class="nx">request</span><span class="p">({</span> <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">eth_requestAccounts</span><span class="dl">"</span> <span class="p">});</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">User denied account access</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">web3</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">App</span><span class="p">.</span><span class="nx">web3Provider</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">web3</span><span class="p">.</span><span class="nx">currentProvider</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// 直连</span>
    <span class="nx">App</span><span class="p">.</span><span class="nx">web3Provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Web3</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">HttpProvider</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://127.0.0.1:7545</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">web3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Web3</span><span class="p">(</span><span class="nx">App</span><span class="p">.</span><span class="nx">web3Provider</span><span class="p">);</span>

  <span class="c1">// 初始化合约</span>
  <span class="k">return</span> <span class="nx">App</span><span class="p">.</span><span class="nx">initContract</span><span class="p">();</span>
<span class="p">},</span>
</code></pre></div></div><ol><li>为 contract 设置 provider</li></ol><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 2. 为合约设置 Provider</span>
<span class="nx">initContract</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Adoption.json因为lite-server配置了"baseDir": ["./src", "./build/contracts"]，所以可以</span>
  <span class="c1">// 直接读取编译后的合约文件</span>
  <span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="dl">"</span><span class="s2">Adoption.json</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 获取必要的合约工件文件并使用 @truffle/contract 实例化它</span>
    <span class="kd">var</span> <span class="nx">AdoptionArtifact</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
    <span class="nx">App</span><span class="p">.</span><span class="nx">contracts</span><span class="p">.</span><span class="nx">Adoption</span> <span class="o">=</span> <span class="nx">TruffleContract</span><span class="p">(</span><span class="nx">AdoptionArtifact</span><span class="p">);</span>

    <span class="c1">// 为我们的合约设置provider</span>
    <span class="nx">App</span><span class="p">.</span><span class="nx">contracts</span><span class="p">.</span><span class="nx">Adoption</span><span class="p">.</span><span class="nx">setProvider</span><span class="p">(</span><span class="nx">App</span><span class="p">.</span><span class="nx">web3Provider</span><span class="p">);</span>

    <span class="c1">// 调用合约检索并标记领养之前领养的宠物</span>
    <span class="k">return</span> <span class="nx">App</span><span class="p">.</span><span class="nx">markAdopted</span><span class="p">();</span>
  <span class="p">});</span>

  <span class="k">return</span> <span class="nx">App</span><span class="p">.</span><span class="nx">bindEvents</span><span class="p">();</span>
<span class="p">},</span>
</code></pre></div></div><ol><li>调用 contract.getadopters() 函数获取历史领养数据</li></ol><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 查询已经领养的用户（账号），并标记</span>
<span class="nx">markAdopted</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">adoptionInstance</span><span class="p">;</span>

  <span class="nx">App</span><span class="p">.</span><span class="nx">contracts</span><span class="p">.</span><span class="nx">Adoption</span><span class="p">.</span><span class="nx">deployed</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">adoptionInstance</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">adoptionInstance</span><span class="p">.</span><span class="nx">getadopters</span><span class="p">.</span><span class="nx">call</span><span class="p">();</span>
  <span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">adopters</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">adopters</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">adopters</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">!==</span> <span class="dl">"</span><span class="s2">0x0000000000000000000000000000000000000000</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">.panel-pet</span><span class="dl">"</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="dl">"</span><span class="s2">button</span><span class="dl">"</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="dl">"</span><span class="s2">Success</span><span class="dl">"</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">disabled</span><span class="dl">"</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">},</span>
</code></pre></div></div><ol><li>注册 adopt 按钮事件，调用 contract.adopt() 领养函数</li></ol><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">bindEvents</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// 绑定页面领养按钮</span>
  <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">.btn-adopt</span><span class="dl">"</span><span class="p">,</span> <span class="nx">App</span><span class="p">.</span><span class="nx">handleAdopt</span><span class="p">);</span>
<span class="p">},</span>

<span class="c1">// 查询已经领养的用户（账号），并标记</span>
<span class="nx">markAdopted</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">adoptionInstance</span><span class="p">;</span>

	<span class="nx">App</span><span class="p">.</span><span class="nx">contracts</span><span class="p">.</span><span class="nx">Adoption</span><span class="p">.</span><span class="nx">deployed</span><span class="p">()</span>
		<span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">adoptionInstance</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">;</span>

		<span class="k">return</span> <span class="nx">adoptionInstance</span><span class="p">.</span><span class="nx">getadopters</span><span class="p">.</span><span class="nx">call</span><span class="p">();</span>
	<span class="p">})</span>
	<span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">adopters</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">adopters</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">adopters</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">!==</span> <span class="dl">"</span><span class="s2">0x0000000000000000000000000000000000000000</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 标记未领养的宠物</span>
      <span class="p">}</span>
    <span class="p">})</span>
      <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">},</span>
</code></pre></div></div><p><strong>app.js 完整的代码如下：</strong></p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">App</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">web3Provider</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="na">contracts</span><span class="p">:</span> <span class="p">{},</span>

  <span class="na">init</span><span class="p">:</span> <span class="k">async</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    
    <span class="c1">// 初始化加载页面数据</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="dl">"</span><span class="s2">../pets.json</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">petsRow</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#petsRow</span><span class="dl">"</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">petTemplate</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#petTemplate</span><span class="dl">"</span><span class="p">);</span>

      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">petTemplate</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="dl">"</span><span class="s2">.panel-title</span><span class="dl">"</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="p">);</span>
        <span class="nx">petTemplate</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="dl">"</span><span class="s2">img</span><span class="dl">"</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">src</span><span class="dl">"</span><span class="p">,</span> <span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">picture</span><span class="p">);</span>
        <span class="nx">petTemplate</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="dl">"</span><span class="s2">.pet-breed</span><span class="dl">"</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">breed</span><span class="p">);</span>
        <span class="nx">petTemplate</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="dl">"</span><span class="s2">.pet-age</span><span class="dl">"</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">age</span><span class="p">);</span>
        <span class="nx">petTemplate</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="dl">"</span><span class="s2">.pet-location</span><span class="dl">"</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">location</span><span class="p">);</span>
        <span class="nx">petTemplate</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="dl">"</span><span class="s2">.btn-adopt</span><span class="dl">"</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">data-id</span><span class="dl">"</span><span class="p">,</span> <span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span><span class="p">);</span>

        <span class="nx">petsRow</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">petTemplate</span><span class="p">.</span><span class="nx">html</span><span class="p">());</span>
      <span class="p">}</span>
    <span class="p">});</span>

    <span class="c1">// 初始化web3，设置 provider</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">App</span><span class="p">.</span><span class="nx">initWeb3</span><span class="p">();</span>
  <span class="p">},</span>

  <span class="c1">// 1. 初始化 Web3</span>
  <span class="na">initWeb3</span><span class="p">:</span> <span class="k">async</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">ethereum</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">App</span><span class="p">.</span><span class="nx">web3Provider</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">ethereum</span><span class="p">;</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="k">await</span> <span class="nb">window</span><span class="p">.</span><span class="nx">ethereum</span><span class="p">.</span><span class="nx">request</span><span class="p">({</span> <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">eth_requestAccounts</span><span class="dl">"</span> <span class="p">});</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">User denied account access</span><span class="dl">"</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">web3</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">App</span><span class="p">.</span><span class="nx">web3Provider</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">web3</span><span class="p">.</span><span class="nx">currentProvider</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">App</span><span class="p">.</span><span class="nx">web3Provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Web3</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">HttpProvider</span><span class="p">(</span>
        <span class="dl">"</span><span class="s2">http://127.0.0.1:7545</span><span class="dl">"</span>
      <span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">web3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Web3</span><span class="p">(</span><span class="nx">App</span><span class="p">.</span><span class="nx">web3Provider</span><span class="p">);</span>

    <span class="c1">// 初始化合约</span>
    <span class="k">return</span> <span class="nx">App</span><span class="p">.</span><span class="nx">initContract</span><span class="p">();</span>
  <span class="p">},</span>

  <span class="c1">// 2. 为合约设置 Provider</span>
  <span class="na">initContract</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Adoption.json因为lite-server配置了"baseDir": ["./src", "./build/contracts"]，所以可以</span>
    <span class="c1">// 直接读取编译后的合约文件</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="dl">"</span><span class="s2">Adoption.json</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 获取必要的合约工件文件并使用 @truffle/contract 实例化它</span>
      <span class="kd">var</span> <span class="nx">AdoptionArtifact</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
      <span class="nx">App</span><span class="p">.</span><span class="nx">contracts</span><span class="p">.</span><span class="nx">Adoption</span> <span class="o">=</span> <span class="nx">TruffleContract</span><span class="p">(</span><span class="nx">AdoptionArtifact</span><span class="p">);</span>

      <span class="c1">// 为我们的合约设置provider</span>
      <span class="nx">App</span><span class="p">.</span><span class="nx">contracts</span><span class="p">.</span><span class="nx">Adoption</span><span class="p">.</span><span class="nx">setProvider</span><span class="p">(</span><span class="nx">App</span><span class="p">.</span><span class="nx">web3Provider</span><span class="p">);</span>

      <span class="c1">// 调用合约检索并标记领养之前领养的宠物</span>
      <span class="k">return</span> <span class="nx">App</span><span class="p">.</span><span class="nx">markAdopted</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">App</span><span class="p">.</span><span class="nx">bindEvents</span><span class="p">();</span>
  <span class="p">},</span>

  <span class="na">bindEvents</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 绑定页面领养按钮</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">.btn-adopt</span><span class="dl">"</span><span class="p">,</span> <span class="nx">App</span><span class="p">.</span><span class="nx">handleAdopt</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="c1">// 查询已经领养的用户（账号），并标记</span>
  <span class="na">markAdopted</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">adoptionInstance</span><span class="p">;</span>

    <span class="nx">App</span><span class="p">.</span><span class="nx">contracts</span><span class="p">.</span><span class="nx">Adoption</span><span class="p">.</span><span class="nx">deployed</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">adoptionInstance</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">;</span>

        <span class="k">return</span> <span class="nx">adoptionInstance</span><span class="p">.</span><span class="nx">getadopters</span><span class="p">.</span><span class="nx">call</span><span class="p">();</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">adopters</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">adopters</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">adopters</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">!==</span> <span class="dl">"</span><span class="s2">0x0000000000000000000000000000000000000000</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">.panel-pet</span><span class="dl">"</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="dl">"</span><span class="s2">button</span><span class="dl">"</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="dl">"</span><span class="s2">Success</span><span class="dl">"</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">disabled</span><span class="dl">"</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
      <span class="p">});</span>
  <span class="p">},</span>

  <span class="c1">// 页面点击领养按钮</span>
  <span class="na">handleAdopt</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

    <span class="kd">var</span> <span class="nx">petId</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">));</span>
    <span class="kd">var</span> <span class="nx">adoptionInstance</span><span class="p">;</span>

    <span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">getAccounts</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">accounts</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="c1">// 这里准确应该使用 window.ethereum.selectAddress</span>
      <span class="kd">var</span> <span class="nx">account</span> <span class="o">=</span> <span class="nx">accounts</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

      <span class="nx">App</span><span class="p">.</span><span class="nx">contracts</span><span class="p">.</span><span class="nx">Adoption</span><span class="p">.</span><span class="nx">deployed</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">adoptionInstance</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">;</span>

          <span class="c1">// 调用合约领养方法</span>
          <span class="k">return</span> <span class="nx">adoptionInstance</span><span class="p">.</span><span class="nx">adopt</span><span class="p">(</span><span class="nx">petId</span><span class="p">,</span> <span class="p">{</span> <span class="na">from</span><span class="p">:</span> <span class="nx">account</span> <span class="p">});</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">App</span><span class="p">.</span><span class="nx">markAdopted</span><span class="p">();</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">},</span>
<span class="p">};</span>

<span class="c1">// 页面加载执行</span>
<span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">load</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">App</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">});</span>

</code></pre></div></div><p>至此我们已经完成了合约和前端交互的开发，这里主要核心还是 app.js 中，合约如何连接、合约如何实例化、合约如何调用的处理。</p><h3 id="33-运行测试应用">3.3. 运行测试应用</h3><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm run dev
</code></pre></div></div><video controls="" width="100%"> <source src="https://pan.wangjun.dev/wl/?id=ZYS10t5Tp0XVzlIXo3gXz6vvlHsEFu9b&amp;fmode=open" type="video/mp4" /> </video><h2 id="4-faq">4. FAQ</h2><h3 id="41-如何解决truffle-compile下载solc报错">4.1. 如何解决truffle compile，下载solc报错？</h3><p>执行 <code class="language-plaintext highlighter-rouge">truffle compile</code>，truffle 会根据源码指定的 Solidity 版本下载对应的编译器 <code class="language-plaintext highlighter-rouge">solc</code>，可能会下载失败，建议使用二进制下载 solc 编译器，关于如何安装参看 <a href="https://docs.soliditylang.org/en/v0.8.10/installing-solidity.html">Installing the Solidity Compiler</a>，安装好打开终端查看编译器版本：</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> solc <span class="nt">--version</span>
solc, the solidity compiler commandline interface
Version: 0.8.17+commit.8df45f5f.Darwin.appleclang
</code></pre></div></div><p>将合约源码指定的版本号与下载的<code class="language-plaintext highlighter-rouge">solc</code>版本号对齐，新增或者修改 <code class="language-plaintext highlighter-rouge">truffle-config.js</code>文件，指定编译器为 <code class="language-plaintext highlighter-rouge">native</code>，再次执行 <code class="language-plaintext highlighter-rouge">truffle compile</code>即可</p><p><img src="https://pic.wangjun.dev/i/2022/12/21/btw1o2-0.jpg" alt="solc download failure" /></p><h3 id="42-完整代码下载路径">4.2. 完整代码下载路径</h3><p><a href="https://github.com/wangjunneil/my-pet-shop">https://github.com/wangjunneil/my-pet-shop</a></p><div class="divider"></div><blockquote id='by-nc-nd'><div> 版权所有，本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/">知识共享署名-非商业性使用 3.0 未本地化版本许可协议</a>进行许可。转载请注明出处：<a href="https://www.wangjun.dev//2022/12/pet-shop-dapp/" akt="">https://www.wangjun.dev//2022/12/pet-shop-dapp/</a></div></blockquote><div class="divider"></div></article><div class="page-navigation"> <a class="next" href="/2023/05/python-selenium/" title="NEXT: 由浅入深 python selenium 的使用">&lt;&lt;</a> <span> &middot; </span> <a class="home" href="/" title="Back to Homepage">Home</a> <span> &middot; </span> <a class="prev" href="/2022/12/truffle-infura-georli/" title="PREV: Play with Truffle & Infura & Georli">&gt;&gt;</a></div><!-- 书签处理 --> <script type="text/javascript" src="/assets/js/zepto.min.js"></script> <script type="text/javascript" src="/assets/js/nav.js"></script></main><!-- service worker check update bar --><div id="notification">A new version of this app is available. Click <a id="reload">here</a> to update.</div></body></html>